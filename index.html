<!DOCTYPE html>
<html>
    <head>
        <title>Birthday Cake</title>
        <link href="https://fonts.googleapis.com/css2?family=Schoolbell&display=swap" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <link rel="stylesheet" type="text/css" href="stylesheet.css">
        <script>
            var i = 0;
            var txt = 'Happy Birthday! ';
            var speed = 300;

            function typeWriter() {

                if (i < txt.length) {
                    document.getElementById("prompt").innerHTML = document.getElementById("prompt").innerHTML.slice(0, -1);
                    if (i == txt.length-1){
                        createButton()
                    } else {
                        document.getElementById("prompt").innerHTML += txt.charAt(i) + "_";
                    }
                    i++;
                    setTimeout(typeWriter, speed);
                } 
            }

            window.onload = function() {
                document.body.addEventListener("click", function () {
                    document.getElementById('bgm').play()
                    document.getElementById("music").style.display = "flex"
                })
                document.getElementById("music").addEventListener("click",openLink)
                typeWriter(); 
            };
        </script>
    </head>

    <body>
        <div id="startScene" class="container">
            <p id="prompt"></p>
            <div id="start"></div>
            <div id="chooseSize" class="hoverSize column" style="display: none;">
                <div><figure><img style="cursor: pointer;" id="circle" src="././assets/circle.png" width="103" height="77"></figure></div>
                <div><figure><img style="cursor: pointer;" id="triangle" src="././assets/triangle.png" width="103" height="77"></figure></div>
                <div><figure><img style="cursor: pointer;" id="square" src="././assets/square.png" width="103" height="77"></figure></div>
            </div>
            <div id="chooseFlavor" class="hoverSize column" style="display: none;">
                <div>
                    <figure class="container2">
                        
                        <img src="././assets/vanilla flavor.png" class="base" width="103" height="77" alt="Base Image">
                        <img class="overlay topSize" width="103" height="77" alt="Overlay Image">
                        <div class="overlay">
                          <img style="cursor: pointer;" class="overlay sizeBase" id="vanilla" width="103" height="77" alt="Overlay Image">
                        </div>
                    </figure>
                </div>              
                <div>
                    <figure class="container2">
                        <img src="././assets/chocolate flavor.png" class="base" width="103" height="77" alt="Base Image">
                        <img class="overlay topSize" width="103" height="77" alt="Overlay Image">
                        <div class="overlay">
                          <img style="cursor: pointer;" class="overlay sizeBase" id="chocolate1" width="103" height="77" alt="Overlay Image">
                        </div>
                    </figure>
                </div> 
                <div>
                    <figure class="container2">
                        <img src="././assets/red velvet flavor.png" class="base" width="103" height="77" alt="Base Image">
                        <img class="overlay topSize" width="103" height="77" alt="Overlay Image">
                        <div class="overlay">
                          <img style="cursor: pointer;" class="overlay sizeBase" id="red velvet" width="103" height="77" alt="Overlay Image">
                        </div>
                    </figure>
                </div> 
            </div>
            <div id="chooseFilling" class="hoverSize column" style="display: none;">
                <div>
                    <figure class="container2">
                        <img class="base flavorSide" width="103" height="77" alt="Base Image">
                        <img class="overlay topSize" width="103" height="77" alt="Overlay Image">
                        <img class="overlay" src="././assets/cream filling.png" width="103" height="77" alt="Overlay Image">
                        <div class="overlay">
                          <img style="cursor: pointer;" class="overlay sizeBase" id="cream" width="103" height="77" alt="Overlay Image">
                        </div>
                    </figure>
                </div>
                <div>
                    <figure class="container2">
                        <img class="base flavorSide" width="103" height="77" alt="Base Image">
                        <img class="overlay topSize" width="103" height="77" alt="Overlay Image">
                        <img class="overlay" src="././assets/chocolate filling.png" width="103" height="77" alt="Overlay Image">
                        <div class="overlay">
                          <img style="cursor: pointer;" class="overlay sizeBase" id="chocolate2" width="103" height="77" alt="Overlay Image">
                        </div>
                    </figure>
                </div>
                <div>
                    <figure class="container2">
                        <img class="base flavorSide" width="103" height="77" alt="Base Image">
                        <img class="overlay topSize" width="103" height="77" alt="Overlay Image">
                        <img class="overlay" src="././assets/strawberry filling.png" width="103" height="77" alt="Overlay Image">
                        <div class="overlay">
                          <img style="cursor: pointer;" class="overlay sizeBase" id="strawberry1" width="103" height="77" alt="Overlay Image">
                        </div>
                    </figure>
                </div>
            </div>
            <div id="chooseTopping" class="hoverSize column" style="display: none;">
                <div><figure><img style="cursor: pointer;" id="strawberry2" src="././assets/strawberry topping thumbnail.png" width="103" height="103"></figure></div>
                <div><figure><img style="cursor: pointer;" id="sprinkle" src="././assets/sprinkle topping thumbnail.png" width="103" height="103"></figure></div>
                <div><figure><img style="cursor: pointer;" id="oreo" src="././assets/oreo topping thumbnail.png" width="103" height="103"></figure></div>
            </div>
            <div id="enterName"></div>
        </div>
        <div id="endScene" class="column" style="display: none;">
            <div>
                <figure class="container2">
                    <img class="base flavorSide" width="206" height="154" alt="Base Image">
                    <img class="overlay topSize" width="206" height="154" alt="Overlay Image">
                    <img class="overlay" id="filling" width="206" height="154" alt="Overlay Image">
                    <div class="overlay">
                      <img class="overlay sizeBase" width="206" height="154" alt="Overlay Image">
                      <img class="overlay" src="././assets/candle.png"width="206" height="154" alt="Overlay Image">
                      <img class="overlay" id="topping" width="206" height="154" alt="Overlay Image">
                    </div>
                </figure>
            </div>
            <div><p id="finalText"></p></div>
        </div>
        <div style="cursor: pointer; display: none;" id="music">
            <img src="././assets/sound.gif" width="30" height="30" style="margin-right:1rem;">
            <p id="songTitle" style="margin-right:1rem;"></a>it's 6pm but i miss u already</p>
            <audio id="bgm" type="mp3"src="./assets/bgm.mp3"></audio>
        </div>
        <div style="cursor: pointer;" id="downloadImage" style="display: none;">
        </div>
        
        <script>
            var size = "circle"
            var flavor = "vanilla"
            var filling = "cream"
            var topping = "strawberry"
            var name = "name"
            var link = 'https://music.163.com/#/song?id=1890756154'

            function createButton() {
                
                var link = document.createElement("a");
                var span = document.createElement("span");
                span.textContent = "start";
                link.appendChild(span);
                link.style.cursor = "pointer"
                    
                link.addEventListener("click", function() {
                    chooseSize();
                });
                    
                var start = document.getElementById("start");
                start.appendChild(link);
            }

            function chooseSize() {
                document.getElementById("prompt").innerHTML = "Choose Your Cake Shape:"
                document.getElementById("start").style.display = "none"
                document.getElementById("chooseSize").style.display = "block"

                document.getElementById("circle").addEventListener("click", function() {
                    size = "circle"
                    chooseFlavor();
                });

                document.getElementById("triangle").addEventListener("click", function() {
                    size = "triangle"
                    chooseFlavor();
                });

                document.getElementById("square").addEventListener("click", function() {
                    size = "square"
                    chooseFlavor();
                });
            }

            function chooseFlavor() {
                var imageElements = document.getElementsByClassName("sizeBase");
                for (var i = 0; i < imageElements.length; i++) {
                    imageElements[i].src = "./assets/"+size+".png";
                }
                var topSize = size == "triangle" ? "2" : "1";
                var flavors = ["vanilla","chocolate","red velvet"]
                var imageElements = document.getElementsByClassName("topSize");
                for (var i = 0; i < imageElements.length; i++) {
                    imageElements[i].src = "./assets/"+flavors[i]+topSize+" top.png";
                }

                document.getElementById("prompt").innerHTML = "Choose Your Cake Flavor:"
                document.getElementById("chooseSize").style.display = "none"
                document.getElementById("chooseFlavor").style.display = "block"

                document.getElementById("vanilla").addEventListener("click", function() {
                    flavor = "vanilla"
                    chooseFilling();
                });

                document.getElementById("chocolate1").addEventListener("click", function() {
                    flavor = "chocolate"
                    chooseFilling();
                });

                document.getElementById("red velvet").addEventListener("click", function() {
                    flavor = "red velvet"
                    chooseFilling();
                });
            }

            function chooseFilling() {
                var imageElements = document.getElementsByClassName("flavorSide");
                for (var i = 0; i < imageElements.length; i++) {
                    imageElements[i].src = "./assets/"+flavor+" flavor.png";
                }
                var topSize = size == "triangle" ? "2" : "1";
                var imageElements = document.getElementsByClassName("topSize");
                for (var i = 0; i < imageElements.length; i++) {
                    imageElements[i].src = "./assets/"+flavor+topSize+" top.png";
                }
                document.getElementById("prompt").innerHTML = "Choose Your Cake Filling:"
                document.getElementById("chooseFlavor").style.display = "none"
                document.getElementById("chooseFilling").style.display = "block"

                document.getElementById("cream").addEventListener("click", function() {
                    filling = "cream"
                    chooseTopping();
                });

                document.getElementById("chocolate2").addEventListener("click", function() {
                    filling = "chocolate"
                    chooseTopping();
                });

                document.getElementById("strawberry1").addEventListener("click", function() {
                    filling = "strawberry"
                    chooseTopping();
                });
            }

            function chooseTopping() {
                document.getElementById("prompt").innerHTML = "Choose Your Cake Topping:"
                document.getElementById("chooseFilling").style.display = "none"
                document.getElementById("chooseTopping").style.display = "block"

                document.getElementById("sprinkle").addEventListener("click", function() {
                    topping = "sprinkle"
                    enterName();
                });

                document.getElementById("oreo").addEventListener("click", function() {
                    topping = "oreo"
                    enterName();
                });

                document.getElementById("strawberry2").addEventListener("click", function() {
                    topping = "strawberry"
                    enterName();
                });
            }
            
            function enterName() {
                document.getElementById("chooseTopping").style.display = "none"
                document.getElementById("prompt").innerHTML = "Enter Your Name:"
                var txtfield = document.createElement("input");
                txtfield.type = "text"
                txtfield.id = "name field"
                txtfield.className = "textfield"

                var link = document.createElement("a");
                var span = document.createElement("span");
                span.textContent = "submit";
                link.appendChild(span);
                link.style.cursor = "pointer"
                link.addEventListener("click", function() {
                    name = document.getElementById("name field").value;
                    end();
                });

                document.getElementById("enterName").appendChild(link);
                document.getElementById("enterName").appendChild(txtfield);
                

            }

            function end() {
                document.getElementById("bgm").src = "./assets/birthday bgm.mp3"
                document.getElementById("songTitle").innerHTML = "Birthday Song"
                link = "https://www.youtube.com/watch?v=p6EjUkQ3Ut0"
                document.getElementById("filling").src = "./assets/"+filling+" filling.png"
                document.getElementById("topping").src = "./assets/"+topping+" topping.png"
                document.getElementById("endScene").style.display = "flex"
                document.getElementById("startScene").style.display = "none"
                document.getElementById("finalText").innerHTML = "#HBD<br>"+name+"!!"
                document.body.style.backgroundImage = "url('./assets/bg copy.png')";
                downloadImageButton()
            }

            function openLink()
            {
                window.open(link, '_blank');
            }

            function downloadImageButton() {
                
                var link = document.createElement("a");
                var span = document.createElement("span");
                var img = document.createElement('img');
                img.src = './assets/download.png';
                span.appendChild(img);
                link.appendChild(span);
                    
                link.addEventListener("click", function() {
                    html2canvas(document.body,{ 
                        ignoreElements: function(element) {
                            var excludedIds = ['music', 'downloadImage'];
                            if (element.tagName === 'DIV') {
                                if (excludedIds.includes(element.id)) {
                                    return true; 
                                }
                            }
                            return false; 
                        }
                    }).then(canvas => {
                        const a = document.createElement("a");
                        a.href = canvas.toDataURL();
                        a.download = "birthday cake.jpg";
                        a.click();
                    });
                });
                    
                var start = document.getElementById("downloadImage");
                start.appendChild(link);
            }

        </script>
    </body>

</html>